name: Publish Python ðŸ distributions ðŸ“¦ to PyPI

on: push

# on:
#     # Triggers the workflow on push events but only for the main branch
#     push:
#       branches:
#         - main
#       tags:
#         - '*'  # all tags

jobs:
  publish-to-pypi:
    name: Build and publish Python ðŸ distributions ðŸ“¦ to PyPI and TestPyPI
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the source code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
    #   with:
    #     python-version: 3.10  # choose desired version

    - name: Authenticate with PyPI
      run: echo ${{ secrets.PYPI_API_TOKEN }} > ~/.pypirc

    - name: Build and publish package
      run: |
        python -m pip install --upgrade build
        python -m build
        python -m twine upload --config-file ~/.pypirc dist/*

    - name: Clean up
      run: rm -rf dist

    - name: Remove PyPI credentials
      run: rm ~/.pypirc

# ----------------------

    # - name: Install pypa/build
    #   run: >-
    #     python -m
    #     pip install
    #     build
    #     --user

    # - name: Build a binary wheel and a source tarball
    #   run: >-
    #     python -m
    #     build
    #     --sdist
    #     --wheel
    #     --outdir dist/
    #     .

    # - name: Install twine
    #   run: >-
    #     python -m
    #     pip install
    #     twine

    # - name: Check package metadata
    #   run: >-
    #     twine check dist/*

    # - name: Publish distribution ðŸ“¦ to PyPI
    #   if: startsWith(github.ref, 'refs/tags')
    #   uses: pypa/gh-action-pypi-publish@master
    #   with:
    #     user: __token__
    #     password: ${{ secrets.PYPI_API_TOKEN }}
    #     verbose: true